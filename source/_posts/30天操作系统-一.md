---
title: 30天操作系统(一)
date: 2021-09-05 10:09:01
tags: 30天操作系统系列
---

经过30多天的学习, 我完成了日本作者川合秀实的<30天自制操作系统>的前28天, 考虑到后面的2天, 都是利用前28天累积的成果, 开发一些小软件, 例如计算器之类的, 所以我并没有完成第29天和第30天的内容.



总的来说, 这本书还是挺有难度的, 不仅仅在于汇编内容的理解, 而且作者的表达方式极其不友好.

## 前言

这个系列的文章主要会讲文中的操作系统这么几个方面:

1. 系统的启动
2. 内容的显示
3. 硬件的管理
4. 内存的管理

而我们在开始内容之前, 需要讲讲前置知识, 例如汇编指令, 硬件调用方式等.

接下来的内容, 用于之后的文章内所需要的知识点的快速查询, 并且针对每个项目的更加深入的了解, 需要自行谷歌, 否则这里就变成了复制粘贴的工具书了.



## 汇编指令

<font color='red'> 这部分指令仅仅针对作者的编译器, 虽然可能与其他
编译器通用, 但建议在把指令用于其他编译器之前, 先查询编译器自己的官方文档 </font>

##### DB

`DB(data byte)`: 写入一个字节, 或者写入一个字符串(编译器会自行寻找字符对应的编码并且转换为对应的指令, 不用自己找字符编码对照表)

##### DW

`DW(data word)`: 写入双字节, 等同于16位

##### DD

`DD(data double-word)`: 写入四字节, 等同于32位

##### RESB

`RESB(reserve byte)`: 从`RESB`指令位置开始的地方空出`n`个字节并且自动填充`0x00`

##### ORG

`ORG(origin)`: 指令会告诉`nask`(编译器), 在开始执行的时候，把这些机器语言指令装载到内存中的哪个地址(装载位置的起始地址)。如果没有它，有几个机器指令无法执行。并且美元符号的含义也发生改变：它不在表示输出文件的第几个字节，而是代表将要读入的内存地址. 这个指令也被称为"伪指令", 因为它不是机器指令.

##### JMP

`JMP(jump)`: 跳转到某个地址

##### ADD

加法指令

##### CMP

比较指令

##### JE

`JE(jump if equal)`: `CMP`指令如果返回为真， 则执行跳转

##### JC

`JC(jump if carry)`: 如果进位标志(carry flag)是1， 则执行跳转

##### JNC

`JNC(jump if not carry)`: 如果进位标志(carry flag)不是1， 则执行跳转

##### JAE

`JAE(jump if above or equal)`: 大于等于时跳转

##### JBE

`JBE(jump if below or euqal)`: 小于等于时跳转

##### JB

`JB(jump if below)`: 小于时跳转

##### INT

`interrupt`: 中断指令， 发送中断信号给CPU

##### HLT

让CPU进入待机状态

##### MOV

`MOV(move)`: 赋值指令

`MOV AX, 0`: AX寄存器被赋值0

`MOV AX,SS`: AX寄存器被赋值SS寄存器的值

`MOV AX,[0x0001]`: 将内存地址为`0x0001`的值赋值给AX寄存器

## 寄存器

### 常见的16位寄存器

#### 累加寄存器 AX

`accumulator`累加寄存器， 通用16位寄存器之一，用于存放数据或临时存放地址， 可以拆分为两个八位寄存器

##### AL

`accumulator low` 累加寄存器低位， 存储8位数据

##### AH

`accumulator high` 累加寄存器高位，存储8位数据

##### 特殊用法

1. 在乘法指令中存放乘数和乘积
2. 在除法指令中存放被除数和商

#### 计数寄存器 CX

`counter` 计数寄存器， 通用16位寄存器之一， 用于存放数据或临时存放地址， 可以拆分为两个八位寄存器

##### CL

`counter low` 计数寄存器低位， 存储8位数据

##### CH

`counter high` 计数寄存器高位， 存储8位数据

##### 特殊用法

1. CPU在每一次执行`loop`指令的时候，会执行`cx = cx-1`, 如果`cx`值为0则跳出`loop`.

#### 数据寄存器 DX

`data` 数据寄存器，通用16位寄存器之一， 用于存放数据或临时地址， 可以拆分为两个八位寄存器

##### DL

`data low` 数据寄存器低位， 存储8位数据

##### DH

`data high` 数据寄存器高位， 存储8位数据

##### 特殊用法

1. 在字乘法和除法指令中,作辅助累加器(即存放乘积或被除数的高16位)
2. 在输入输出指令中存放16位的端口地址

#### 基址寄存器 BX

`base` 基址寄存器， 通用16位寄存器之一， 用于存放数据或临时地址， 可以拆分为两个八位寄存器

##### BL

`base low` 基址寄存器低位

##### BH

`base high` 基质寄存器高位

##### 特殊用法

1. 作为偏移地址使用， 通常与段寄存器结合使用

#### 栈指针寄存器 SP | 基址指针寄存器 BP | 栈段寄存器 SS

`SP(stack pointer)`：栈指针寄存器







